var nodeVersions = [[{"data":{"name":"jeff (100)","id":"554c1762-82ec-40a2-8079-f16f97255882","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"carl (100)","id":"8e7043c1-dcee-451d-85a0-f9aa567d3e1b","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"bob (100)","id":"d159c051-84e2-400e-9a50-7271c0a2d0a1","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"dave (1)","id":"0cfc5f26-6641-4720-a3b1-38e7751b1ce3","probability":1,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"gene (100)","id":"263ffcfa-7991-4f6b-97fb-71ee25dc976b","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"larry (100)","id":"26c58596-3b12-4357-ab4c-0ec26928e6db","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"scotsman1 (100)","id":"ca310dca-e08f-4cf0-9a4f-1e01e2b5a514","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"scotsman2 (100)","id":"2682bdb3-20d2-4787-9d51-2e2a034d55ba","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"a (100)","id":"ece531a4-c6b4-4a66-b877-c5444726dd53","probability":100,"subgraph":"test subgraph"},"style":{"backgroundColor":"#f602f0"}},{"data":{"name":"b (100)","id":"524051b8-f5f1-48a5-a508-511e9b980d4d","probability":100,"subgraph":"test subgraph"},"style":{"backgroundColor":"#f602f0"}}],[{"data":{"name":"bob (100)","id":"d159c051-84e2-400e-9a50-7271c0a2d0a1","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"_ (100)","id":"e129f354-3142-4d91-b400-73c4c268f684","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#eeeeee"}},{"data":{"name":"_ (100)","id":"6ad95eca-a02b-45a3-a123-a4be130027a1","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#eeeeee"}},{"data":{"name":"_ (100)","id":"761b8c47-9836-4800-a350-707f0dda1998","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#eeeeee"}},{"data":{"name":"scotsman2 (100)","id":"2682bdb3-20d2-4787-9d51-2e2a034d55ba","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"larry (100)","id":"26c58596-3b12-4357-ab4c-0ec26928e6db","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"scotsman1 (100)","id":"ca310dca-e08f-4cf0-9a4f-1e01e2b5a514","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"carl (100)","id":"8e7043c1-dcee-451d-85a0-f9aa567d3e1b","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"_ (100)","id":"677e143a-1f51-4f07-9235-81a377cc7ec6","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#eeeeee"}},{"data":{"name":"b (100)","id":"524051b8-f5f1-48a5-a508-511e9b980d4d","probability":100,"subgraph":"test subgraph"},"style":{"backgroundColor":"#f602f0"}},{"data":{"name":"jeff (100)","id":"554c1762-82ec-40a2-8079-f16f97255882","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"_ (100)","id":"85d28a8c-b63b-493f-9656-f31f9af3d051","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#eeeeee"}},{"data":{"name":"_ (100)","id":"e9139463-9a66-403d-8159-ae15963f8a69","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#eeeeee"}},{"data":{"name":"dave (1)","id":"0cfc5f26-6641-4720-a3b1-38e7751b1ce3","probability":1,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"a (100)","id":"ece531a4-c6b4-4a66-b877-c5444726dd53","probability":100,"subgraph":"test subgraph"},"style":{"backgroundColor":"#f602f0"}},{"data":{"name":"_ (100)","id":"618f9f69-91a6-4f61-bf09-19153c9cbcf7","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#eeeeee"}},{"data":{"name":"_ (100)","id":"d953c18b-4c43-4b53-8124-387715f22bb0","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#eeeeee"}},{"data":{"name":"_ (100)","id":"96b61c68-6506-4bbb-9259-a9ad2020ac8d","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#eeeeee"}},{"data":{"name":"_ (100)","id":"85e2d977-f3db-44ab-b757-3cb30c77a12c","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#eeeeee"}},{"data":{"name":"gene (100)","id":"263ffcfa-7991-4f6b-97fb-71ee25dc976b","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}}],[{"data":{"name":"bob (100)","id":"d159c051-84e2-400e-9a50-7271c0a2d0a1","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"scotsman2 (100)","id":"2682bdb3-20d2-4787-9d51-2e2a034d55ba","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"scotsman1 (100)","id":"ca310dca-e08f-4cf0-9a4f-1e01e2b5a514","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"larry (100)","id":"26c58596-3b12-4357-ab4c-0ec26928e6db","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"carl (100)","id":"8e7043c1-dcee-451d-85a0-f9aa567d3e1b","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"b (100)","id":"524051b8-f5f1-48a5-a508-511e9b980d4d","probability":100,"subgraph":"test subgraph"},"style":{"backgroundColor":"#f602f0"}},{"data":{"name":"jeff (100)","id":"554c1762-82ec-40a2-8079-f16f97255882","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"a (100)","id":"ece531a4-c6b4-4a66-b877-c5444726dd53","probability":100,"subgraph":"test subgraph"},"style":{"backgroundColor":"#f602f0"}},{"data":{"name":"gene (100)","id":"263ffcfa-7991-4f6b-97fb-71ee25dc976b","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}}]]
var edgeVersions = [[{"data":{"id":"554c1762-82ec-40a2-8079-f16f97255882->8e7043c1-dcee-451d-85a0-f9aa567d3e1b","source":"554c1762-82ec-40a2-8079-f16f97255882","target":"8e7043c1-dcee-451d-85a0-f9aa567d3e1b","probability":50,"refinement":null},"style":{"lineColor":"#dddddd","targetArrowColor":"#dddddd"}},{"data":{"id":"d159c051-84e2-400e-9a50-7271c0a2d0a1->0cfc5f26-6641-4720-a3b1-38e7751b1ce3","source":"d159c051-84e2-400e-9a50-7271c0a2d0a1","target":"0cfc5f26-6641-4720-a3b1-38e7751b1ce3","probability":50,"refinement":null},"style":{"lineColor":"#e28234","targetArrowColor":"#e28234"}},{"data":{"id":"d159c051-84e2-400e-9a50-7271c0a2d0a1->263ffcfa-7991-4f6b-97fb-71ee25dc976b","source":"d159c051-84e2-400e-9a50-7271c0a2d0a1","target":"263ffcfa-7991-4f6b-97fb-71ee25dc976b","probability":40,"refinement":null},"style":{"lineColor":"#e28234","targetArrowColor":"#e28234"}},{"data":{"id":"0cfc5f26-6641-4720-a3b1-38e7751b1ce3->26c58596-3b12-4357-ab4c-0ec26928e6db","source":"0cfc5f26-6641-4720-a3b1-38e7751b1ce3","target":"26c58596-3b12-4357-ab4c-0ec26928e6db","probability":75,"refinement":null},"style":{"lineColor":"#dddddd","targetArrowColor":"#dddddd"}}],[{"data":{"id":"26c58596-3b12-4357-ab4c-0ec26928e6db->6ad95eca-a02b-45a3-a123-a4be130027a1","source":"26c58596-3b12-4357-ab4c-0ec26928e6db","target":"6ad95eca-a02b-45a3-a123-a4be130027a1","probability":100,"refinement":null},"style":{"lineColor":"#e36e46","targetArrowColor":"#e36e46"}},{"data":{"id":"263ffcfa-7991-4f6b-97fb-71ee25dc976b->96b61c68-6506-4bbb-9259-a9ad2020ac8d","source":"263ffcfa-7991-4f6b-97fb-71ee25dc976b","target":"96b61c68-6506-4bbb-9259-a9ad2020ac8d","probability":100,"refinement":null},"style":{"lineColor":"#e36e46","targetArrowColor":"#e36e46"}},{"data":{"id":"8e7043c1-dcee-451d-85a0-f9aa567d3e1b->85e2d977-f3db-44ab-b757-3cb30c77a12c","source":"8e7043c1-dcee-451d-85a0-f9aa567d3e1b","target":"85e2d977-f3db-44ab-b757-3cb30c77a12c","probability":100,"refinement":null},"style":{"lineColor":"#e36e46","targetArrowColor":"#e36e46"}},{"data":{"id":"ece531a4-c6b4-4a66-b877-c5444726dd53->677e143a-1f51-4f07-9235-81a377cc7ec6","source":"ece531a4-c6b4-4a66-b877-c5444726dd53","target":"677e143a-1f51-4f07-9235-81a377cc7ec6","probability":100,"refinement":null},"style":{"lineColor":"#e36e46","targetArrowColor":"#e36e46"}},{"data":{"id":"2682bdb3-20d2-4787-9d51-2e2a034d55ba->85d28a8c-b63b-493f-9656-f31f9af3d051","source":"2682bdb3-20d2-4787-9d51-2e2a034d55ba","target":"85d28a8c-b63b-493f-9656-f31f9af3d051","probability":100,"refinement":null},"style":{"lineColor":"#e36e46","targetArrowColor":"#e36e46"}},{"data":{"id":"ca310dca-e08f-4cf0-9a4f-1e01e2b5a514->d953c18b-4c43-4b53-8124-387715f22bb0","source":"ca310dca-e08f-4cf0-9a4f-1e01e2b5a514","target":"d953c18b-4c43-4b53-8124-387715f22bb0","probability":100,"refinement":null},"style":{"lineColor":"#e36e46","targetArrowColor":"#e36e46"}},{"data":{"id":"524051b8-f5f1-48a5-a508-511e9b980d4d->618f9f69-91a6-4f61-bf09-19153c9cbcf7","source":"524051b8-f5f1-48a5-a508-511e9b980d4d","target":"618f9f69-91a6-4f61-bf09-19153c9cbcf7","probability":100,"refinement":null},"style":{"lineColor":"#e36e46","targetArrowColor":"#e36e46"}},{"data":{"id":"554c1762-82ec-40a2-8079-f16f97255882->8e7043c1-dcee-451d-85a0-f9aa567d3e1b","source":"554c1762-82ec-40a2-8079-f16f97255882","target":"8e7043c1-dcee-451d-85a0-f9aa567d3e1b","probability":50,"refinement":null},"style":{"lineColor":"#01df5a","targetArrowColor":"#01df5a"}},{"data":{"id":"d159c051-84e2-400e-9a50-7271c0a2d0a1->0cfc5f26-6641-4720-a3b1-38e7751b1ce3","source":"d159c051-84e2-400e-9a50-7271c0a2d0a1","target":"0cfc5f26-6641-4720-a3b1-38e7751b1ce3","probability":50,"refinement":null},"style":{"lineColor":"#e28234","targetArrowColor":"#e28234"}},{"data":{"id":"d159c051-84e2-400e-9a50-7271c0a2d0a1->263ffcfa-7991-4f6b-97fb-71ee25dc976b","source":"d159c051-84e2-400e-9a50-7271c0a2d0a1","target":"263ffcfa-7991-4f6b-97fb-71ee25dc976b","probability":40,"refinement":null},"style":{"lineColor":"#e28234","targetArrowColor":"#e28234"}},{"data":{"id":"0cfc5f26-6641-4720-a3b1-38e7751b1ce3->26c58596-3b12-4357-ab4c-0ec26928e6db","source":"0cfc5f26-6641-4720-a3b1-38e7751b1ce3","target":"26c58596-3b12-4357-ab4c-0ec26928e6db","probability":75,"refinement":null},"style":{"lineColor":"#9a04de","targetArrowColor":"#9a04de"}},{"data":{"id":"554c1762-82ec-40a2-8079-f16f97255882->e129f354-3142-4d91-b400-73c4c268f684","source":"554c1762-82ec-40a2-8079-f16f97255882","target":"e129f354-3142-4d91-b400-73c4c268f684","probability":50,"refinement":null},"style":{"lineColor":"#01df5a","targetArrowColor":"#01df5a"}},{"data":{"id":"0cfc5f26-6641-4720-a3b1-38e7751b1ce3->e9139463-9a66-403d-8159-ae15963f8a69","source":"0cfc5f26-6641-4720-a3b1-38e7751b1ce3","target":"e9139463-9a66-403d-8159-ae15963f8a69","probability":25,"refinement":null},"style":{"lineColor":"#9a04de","targetArrowColor":"#9a04de"}},{"data":{"id":"d159c051-84e2-400e-9a50-7271c0a2d0a1->761b8c47-9836-4800-a350-707f0dda1998","source":"d159c051-84e2-400e-9a50-7271c0a2d0a1","target":"761b8c47-9836-4800-a350-707f0dda1998","probability":10,"refinement":null},"style":{"lineColor":"#e28234","targetArrowColor":"#e28234"}}],[{"data":{"id":"d159c051-84e2-400e-9a50-7271c0a2d0a1->263ffcfa-7991-4f6b-97fb-71ee25dc976b","source":"d159c051-84e2-400e-9a50-7271c0a2d0a1","target":"263ffcfa-7991-4f6b-97fb-71ee25dc976b","probability":40,"refinement":null},"style":{"lineColor":"#e28234","targetArrowColor":"#e28234"}},{"data":{"id":"554c1762-82ec-40a2-8079-f16f97255882->8e7043c1-dcee-451d-85a0-f9aa567d3e1b","source":"554c1762-82ec-40a2-8079-f16f97255882","target":"8e7043c1-dcee-451d-85a0-f9aa567d3e1b","probability":50,"refinement":null},"style":{"lineColor":"#01df5a","targetArrowColor":"#01df5a"}}]]
var outcomes = [null,null,"eh"]
var workflows = [null,null,[{"entity":"java.lang.Integer","instance":"183812435","instanceName":"jeff","id":"554c1762-82ec-40a2-8079-f16f97255882"},{"entity":"java.lang.Integer","instance":"-1136407510","instanceName":"a","id":"ece531a4-c6b4-4a66-b877-c5444726dd53"},{"entity":"java.lang.Integer","instance":"5","instanceName":"bob","id":"d159c051-84e2-400e-9a50-7271c0a2d0a1"},{"entity":"java.lang.Boolean","instance":"true","instanceName":"scotsman2","id":"2682bdb3-20d2-4787-9d51-2e2a034d55ba"},{"entity":"java.lang.Boolean","instance":"false","instanceName":"scotsman1","id":"ca310dca-e08f-4cf0-9a4f-1e01e2b5a514"},{"entity":"java.lang.Integer","instance":"-2117371699","instanceName":"b","id":"524051b8-f5f1-48a5-a508-511e9b980d4d"},{"entity":"java.lang.Integer","instance":"1865648353","instanceName":"gene","id":"263ffcfa-7991-4f6b-97fb-71ee25dc976b"},{"entity":"java.lang.String","instance":"183812435","instanceName":"carl","id":"8e7043c1-dcee-451d-85a0-f9aa567d3e1b"},{"entity":"java.lang.Integer","instance":"6","instanceName":"larry","id":"26c58596-3b12-4357-ab4c-0ec26928e6db"}]]
var graphTitle = "NEW PROSPEXT PARENTING"

var pageTitle = document.getElementById("page-title")
pageTitle.innerHTML = graphTitle

var graphVersion = 0;

var rootSubgraphName = "ROOT";
var subgraphNames = new Set(nodeVersions[0].map(n => n.data.subgraph));
var subgraphNamesArray = [...subgraphNames];
if (!subgraphNames.has(rootSubgraphName)) {
    subgraphNamesArray.unshift(rootSubgraphName);
}

for (var i = 0; i < subgraphNamesArray.length; i++) {
    var selected = i === 0;
    console.log(subgraphNamesArray[i]);
    document.getElementById("subgraph-view").appendChild(new Option(subgraphNamesArray[i], i, selected, selected))
}

function changeSubgraph(i) {
    var subgraphName = subgraphNamesArray[i];

    if (subgraphName === rootSubgraphName) {
        // refresh with all nodes and edges
        refreshGraph(nodeVersions[graphVersion], edgeVersions[graphVersion], workflows[graphVersion]);
        return;
    }

    // filter nodes
    var componentNodes = nodeVersions[graphVersion].filter(node => node.data.subgraph === subgraphName);
    var componentNodeIds = componentNodes.map(node => node.data.id);

    // filter edges
    var componentEdges = edgeVersions[graphVersion].filter(edge => componentNodeIds.includes(edge.data.source));

    // filter workflow
    var componentWorkflow = null;
    if (outcomes[graphVersion]) {
        componentWorkflow = workflows[graphVersion].filter(workflow => componentNodeIds.includes(workflow.id));
    }

    refreshGraph(componentNodes, componentEdges, componentWorkflow);
}

for (var i = 0; i < nodeVersions.length; i++) {
    var selected = i === 0;
    document.getElementById("graph-view").appendChild(new Option(i, i, selected, selected))
}

function refreshGraph(nodes, edges, workflow) {
    // changing the graph
    cy_r.elements().remove();

    var elements = {
        nodes: nodes,
        edges: edges
    }

    cy_r.add(elements);
    cy_r.layout({name: 'dagre', spacingFactor: 2}).run();

    // changing the table
    if (!outcomes[graphVersion]) {
        return;
    }

    var tableNode = document.getElementById("workflow-table");
    tableNode.innerHTML = "";
    //var outcomeNode = document.createTextNode("OUTCOME: " + outcomes[i]);
    //document.getElementById("workflow").insertBefore(outcomeNode, tableNode);
    for (var i = 0; i < workflow.length; i++) {
        var row = tableNode.insertRow(-1);
        var entityName = row.insertCell(0);
        var entityType = row.insertCell(1);
        var entityValue = row.insertCell(2);
        entityName.innerHTML = workflow[i].instanceName;
        entityType.innerHTML = workflow[i].entity;
        entityValue.innerHTML = workflow[i].instance;
    }
}

function changeGraph(i) {
    graphVersion = i;
    document.getElementById("subgraph-view").selectedIndex = 0;
    refreshGraph(nodeVersions[i], edgeVersions[i], workflows[i]);
}

var cy_r = cytoscape({
    container: document.getElementById('cy_r'),

    boxSelectionEnabled: false,
    autounselectify: true,

    style: cytoscape.stylesheet()
        .selector('node')
        .css({
            'content': 'data(name)',
            'width': 100,
            'height': 100,
            'font-size': 30,
            'background-color': '#4eff84'
        })
        .selector('edge')
        .css({
            'content': 'data(probability)',
            'curve-style': 'bezier',
            'font-size': 20,
            'target-arrow-shape': 'triangle',
            'width': 10,
            'line-color': '#ddd',
            'target-arrow-color': '#ddd',
            'control-point-step-size': 125
        })
        .selector('.highlighted')
        .css({
            'background-color': '#9e7aff',
            'line-color': '#9e7aff',
            'target-arrow-color': '#9e7aff',
            'transition-property': 'background-color, line-color, target-arrow-color',
            'transition-duration': '0.5s'
        }),

    elements: {
        nodes: nodeVersions[0],
        edges: edgeVersions[0]
    },

    layout: {
        name: 'dagre',
        spacingFactor: 2
    }
});

// DAGRE LAYOUT OPTIONS:
//var defaults = {
//  // dagre algo options, uses default value on undefined
//  nodeSep: undefined, // the separation between adjacent nodes in the same rank
//  edgeSep: undefined, // the separation between adjacent edges in the same rank
//  rankSep: undefined, // the separation between each rank in the layout
//  rankDir: undefined, // 'TB' for top to bottom flow, 'LR' for left to right,
//  ranker: undefined, // Type of algorithm to assign a rank to each node in the input graph. Possible values: 'network-simplex', 'tight-tree' or 'longest-path'
//  minLen: function( edge ){ return 1; }, // number of ranks to keep between the source and target of the edge
//  edgeWeight: function( edge ){ return 1; }, // higher weight edges are generally made shorter and straighter than lower weight edges
//
//  // general layout options
//  fit: true, // whether to fit to viewport
//  padding: 30, // fit padding
//  spacingFactor: undefined, // Applies a multiplicative factor (>0) to expand or compress the overall area that the nodes take up
//  nodeDimensionsIncludeLabels: false, // whether labels should be included in determining the space used by a node
//  animate: false, // whether to transition the node positions
//  animateFilter: function( node, i ){ return true; }, // whether to animate specific nodes when animation is on; non-animated nodes immediately go to their final positions
//  animationDuration: 500, // duration of animation in ms if enabled
//  animationEasing: undefined, // easing of animation if enabled
//  boundingBox: undefined, // constrain layout bounds; { x1, y1, x2, y2 } or { x1, y1, w, h }
//  transform: function( node, pos ){ return pos; }, // a function that applies a transform to the final node position
//  ready: function(){}, // on layoutready
//  stop: function(){} // on layoutstop
//};
