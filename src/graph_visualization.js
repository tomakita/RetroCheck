var nodeVersions = [[{"data":{"name":"jeff (100)","id":"bdea4428-141c-4dfc-a85a-171816f03f74","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"carl (100)","id":"7084b306-85a6-4079-80c9-6b6ad854c4d8","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"bob (100)","id":"826bbfc2-abe9-4e73-b586-b775f359652b","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"dave (1)","id":"c8732dac-6b43-45f4-9cba-af1da6c8b4ff","probability":1,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"gene (100)","id":"2018e1ee-aff5-41fa-b266-0ad0797355b1","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"larry (100)","id":"b7938108-3dc9-4ed3-a090-1222c442ba41","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"s1 (100)","id":"ec8302ad-d026-49e3-8f34-49888f3da395","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"s2 (100)","id":"d20a913a-9fdb-4f7a-962e-c0ad7d125bdc","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"a (100)","id":"61be7743-ffdc-47c8-944b-61787c62d852","probability":100,"subgraph":"test subgraph"},"style":{"backgroundColor":"#0683da"}},{"data":{"name":"b (100)","id":"0f9c9559-892c-4704-802a-46fd0c548c09","probability":100,"subgraph":"test subgraph"},"style":{"backgroundColor":"#0683da"}}],[{"data":{"name":"_ (100)","id":"59138bd7-1129-4d84-bd6e-cdc8f66d38c1","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#eeeeee"}},{"data":{"name":"jeff (100)","id":"bdea4428-141c-4dfc-a85a-171816f03f74","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"_ (100)","id":"db380cd5-8a45-4c19-ab8b-bca60ee6dd5c","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#eeeeee"}},{"data":{"name":"b (100)","id":"0f9c9559-892c-4704-802a-46fd0c548c09","probability":100,"subgraph":"test subgraph"},"style":{"backgroundColor":"#0683da"}},{"data":{"name":"a (100)","id":"61be7743-ffdc-47c8-944b-61787c62d852","probability":100,"subgraph":"test subgraph"},"style":{"backgroundColor":"#0683da"}},{"data":{"name":"_ (100)","id":"b44ef92d-28e9-43aa-9643-4064b4d260f9","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#eeeeee"}},{"data":{"name":"gene (100)","id":"2018e1ee-aff5-41fa-b266-0ad0797355b1","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"_ (100)","id":"266e199a-cebb-4025-991c-ffca0a5506e4","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#eeeeee"}},{"data":{"name":"_ (100)","id":"bd6dc801-de15-434d-9768-a4439e39fe08","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#eeeeee"}},{"data":{"name":"_ (100)","id":"80bca910-408a-4dba-a6f5-cbf4241f012d","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#eeeeee"}},{"data":{"name":"larry (100)","id":"b7938108-3dc9-4ed3-a090-1222c442ba41","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"_ (100)","id":"0d3cd9b4-8ef5-47e9-86f8-faa9f7911f45","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#eeeeee"}},{"data":{"name":"carl (100)","id":"7084b306-85a6-4079-80c9-6b6ad854c4d8","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"bob (100)","id":"826bbfc2-abe9-4e73-b586-b775f359652b","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"_ (100)","id":"e31435ed-9500-47f6-8f2f-e5982d15f29b","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#eeeeee"}},{"data":{"name":"dave (1)","id":"c8732dac-6b43-45f4-9cba-af1da6c8b4ff","probability":1,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"_ (100)","id":"1b4917eb-865c-40a9-b64c-38ced003b56c","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#eeeeee"}},{"data":{"name":"_ (100)","id":"8f634e64-6d5c-4668-9899-8dede0d94825","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#eeeeee"}},{"data":{"name":"s2 (100)","id":"d20a913a-9fdb-4f7a-962e-c0ad7d125bdc","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"s1 (100)","id":"ec8302ad-d026-49e3-8f34-49888f3da395","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}}],[{"data":{"name":"jeff (100)","id":"bdea4428-141c-4dfc-a85a-171816f03f74","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"b (100)","id":"0f9c9559-892c-4704-802a-46fd0c548c09","probability":100,"subgraph":"test subgraph"},"style":{"backgroundColor":"#0683da"}},{"data":{"name":"a (100)","id":"61be7743-ffdc-47c8-944b-61787c62d852","probability":100,"subgraph":"test subgraph"},"style":{"backgroundColor":"#0683da"}},{"data":{"name":"gene (100)","id":"2018e1ee-aff5-41fa-b266-0ad0797355b1","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"larry (100)","id":"b7938108-3dc9-4ed3-a090-1222c442ba41","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"bob (100)","id":"826bbfc2-abe9-4e73-b586-b775f359652b","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"carl (100)","id":"7084b306-85a6-4079-80c9-6b6ad854c4d8","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"s2 (100)","id":"d20a913a-9fdb-4f7a-962e-c0ad7d125bdc","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}},{"data":{"name":"s1 (100)","id":"ec8302ad-d026-49e3-8f34-49888f3da395","probability":100,"subgraph":"ROOT"},"style":{"backgroundColor":"#4eff84"}}]]
var edgeVersions = [[{"data":{"id":"bdea4428-141c-4dfc-a85a-171816f03f74->7084b306-85a6-4079-80c9-6b6ad854c4d8","source":"bdea4428-141c-4dfc-a85a-171816f03f74","target":"7084b306-85a6-4079-80c9-6b6ad854c4d8","probability":50,"refinement":null},"style":{"lineColor":"#dddddd","targetArrowColor":"#dddddd"}},{"data":{"id":"826bbfc2-abe9-4e73-b586-b775f359652b->c8732dac-6b43-45f4-9cba-af1da6c8b4ff","source":"826bbfc2-abe9-4e73-b586-b775f359652b","target":"c8732dac-6b43-45f4-9cba-af1da6c8b4ff","probability":50,"refinement":null},"style":{"lineColor":"#07c8f8","targetArrowColor":"#07c8f8"}},{"data":{"id":"826bbfc2-abe9-4e73-b586-b775f359652b->2018e1ee-aff5-41fa-b266-0ad0797355b1","source":"826bbfc2-abe9-4e73-b586-b775f359652b","target":"2018e1ee-aff5-41fa-b266-0ad0797355b1","probability":40,"refinement":null},"style":{"lineColor":"#07c8f8","targetArrowColor":"#07c8f8"}},{"data":{"id":"c8732dac-6b43-45f4-9cba-af1da6c8b4ff->b7938108-3dc9-4ed3-a090-1222c442ba41","source":"c8732dac-6b43-45f4-9cba-af1da6c8b4ff","target":"b7938108-3dc9-4ed3-a090-1222c442ba41","probability":75,"refinement":null},"style":{"lineColor":"#dddddd","targetArrowColor":"#dddddd"}}],[{"data":{"id":"b7938108-3dc9-4ed3-a090-1222c442ba41->db380cd5-8a45-4c19-ab8b-bca60ee6dd5c","source":"b7938108-3dc9-4ed3-a090-1222c442ba41","target":"db380cd5-8a45-4c19-ab8b-bca60ee6dd5c","probability":100,"refinement":null},"style":{"lineColor":"#3cfeb9","targetArrowColor":"#3cfeb9"}},{"data":{"id":"7084b306-85a6-4079-80c9-6b6ad854c4d8->59138bd7-1129-4d84-bd6e-cdc8f66d38c1","source":"7084b306-85a6-4079-80c9-6b6ad854c4d8","target":"59138bd7-1129-4d84-bd6e-cdc8f66d38c1","probability":100,"refinement":null},"style":{"lineColor":"#3cfeb9","targetArrowColor":"#3cfeb9"}},{"data":{"id":"2018e1ee-aff5-41fa-b266-0ad0797355b1->266e199a-cebb-4025-991c-ffca0a5506e4","source":"2018e1ee-aff5-41fa-b266-0ad0797355b1","target":"266e199a-cebb-4025-991c-ffca0a5506e4","probability":100,"refinement":null},"style":{"lineColor":"#3cfeb9","targetArrowColor":"#3cfeb9"}},{"data":{"id":"0f9c9559-892c-4704-802a-46fd0c548c09->bd6dc801-de15-434d-9768-a4439e39fe08","source":"0f9c9559-892c-4704-802a-46fd0c548c09","target":"bd6dc801-de15-434d-9768-a4439e39fe08","probability":100,"refinement":null},"style":{"lineColor":"#3cfeb9","targetArrowColor":"#3cfeb9"}},{"data":{"id":"61be7743-ffdc-47c8-944b-61787c62d852->80bca910-408a-4dba-a6f5-cbf4241f012d","source":"61be7743-ffdc-47c8-944b-61787c62d852","target":"80bca910-408a-4dba-a6f5-cbf4241f012d","probability":100,"refinement":null},"style":{"lineColor":"#3cfeb9","targetArrowColor":"#3cfeb9"}},{"data":{"id":"d20a913a-9fdb-4f7a-962e-c0ad7d125bdc->0d3cd9b4-8ef5-47e9-86f8-faa9f7911f45","source":"d20a913a-9fdb-4f7a-962e-c0ad7d125bdc","target":"0d3cd9b4-8ef5-47e9-86f8-faa9f7911f45","probability":100,"refinement":null},"style":{"lineColor":"#3cfeb9","targetArrowColor":"#3cfeb9"}},{"data":{"id":"ec8302ad-d026-49e3-8f34-49888f3da395->b44ef92d-28e9-43aa-9643-4064b4d260f9","source":"ec8302ad-d026-49e3-8f34-49888f3da395","target":"b44ef92d-28e9-43aa-9643-4064b4d260f9","probability":100,"refinement":null},"style":{"lineColor":"#3cfeb9","targetArrowColor":"#3cfeb9"}},{"data":{"id":"bdea4428-141c-4dfc-a85a-171816f03f74->7084b306-85a6-4079-80c9-6b6ad854c4d8","source":"bdea4428-141c-4dfc-a85a-171816f03f74","target":"7084b306-85a6-4079-80c9-6b6ad854c4d8","probability":50,"refinement":null},"style":{"lineColor":"#bf16f8","targetArrowColor":"#bf16f8"}},{"data":{"id":"826bbfc2-abe9-4e73-b586-b775f359652b->c8732dac-6b43-45f4-9cba-af1da6c8b4ff","source":"826bbfc2-abe9-4e73-b586-b775f359652b","target":"c8732dac-6b43-45f4-9cba-af1da6c8b4ff","probability":50,"refinement":null},"style":{"lineColor":"#07c8f8","targetArrowColor":"#07c8f8"}},{"data":{"id":"826bbfc2-abe9-4e73-b586-b775f359652b->2018e1ee-aff5-41fa-b266-0ad0797355b1","source":"826bbfc2-abe9-4e73-b586-b775f359652b","target":"2018e1ee-aff5-41fa-b266-0ad0797355b1","probability":40,"refinement":null},"style":{"lineColor":"#07c8f8","targetArrowColor":"#07c8f8"}},{"data":{"id":"c8732dac-6b43-45f4-9cba-af1da6c8b4ff->b7938108-3dc9-4ed3-a090-1222c442ba41","source":"c8732dac-6b43-45f4-9cba-af1da6c8b4ff","target":"b7938108-3dc9-4ed3-a090-1222c442ba41","probability":75,"refinement":null},"style":{"lineColor":"#0c4ff1","targetArrowColor":"#0c4ff1"}},{"data":{"id":"bdea4428-141c-4dfc-a85a-171816f03f74->1b4917eb-865c-40a9-b64c-38ced003b56c","source":"bdea4428-141c-4dfc-a85a-171816f03f74","target":"1b4917eb-865c-40a9-b64c-38ced003b56c","probability":50,"refinement":null},"style":{"lineColor":"#bf16f8","targetArrowColor":"#bf16f8"}},{"data":{"id":"c8732dac-6b43-45f4-9cba-af1da6c8b4ff->8f634e64-6d5c-4668-9899-8dede0d94825","source":"c8732dac-6b43-45f4-9cba-af1da6c8b4ff","target":"8f634e64-6d5c-4668-9899-8dede0d94825","probability":25,"refinement":null},"style":{"lineColor":"#0c4ff1","targetArrowColor":"#0c4ff1"}},{"data":{"id":"826bbfc2-abe9-4e73-b586-b775f359652b->e31435ed-9500-47f6-8f2f-e5982d15f29b","source":"826bbfc2-abe9-4e73-b586-b775f359652b","target":"e31435ed-9500-47f6-8f2f-e5982d15f29b","probability":10,"refinement":null},"style":{"lineColor":"#07c8f8","targetArrowColor":"#07c8f8"}}],[{"data":{"id":"826bbfc2-abe9-4e73-b586-b775f359652b->2018e1ee-aff5-41fa-b266-0ad0797355b1","source":"826bbfc2-abe9-4e73-b586-b775f359652b","target":"2018e1ee-aff5-41fa-b266-0ad0797355b1","probability":40,"refinement":null},"style":{"lineColor":"#07c8f8","targetArrowColor":"#07c8f8"}}]]
var outcomes = [null,null,"eh"]
var workflows = [null,null,[{"entity":"java.lang.Integer","instance":"5","instanceName":"bob","id":"826bbfc2-abe9-4e73-b586-b775f359652b"},{"entity":"java.lang.Integer","instance":"527453873","instanceName":"jeff","id":"bdea4428-141c-4dfc-a85a-171816f03f74"},{"entity":"java.lang.Integer","instance":"-711165773","instanceName":"b","id":"0f9c9559-892c-4704-802a-46fd0c548c09"},{"entity":"java.lang.Integer","instance":"-313723302","instanceName":"a","id":"61be7743-ffdc-47c8-944b-61787c62d852"},{"entity":"java.lang.Boolean","instance":"true","instanceName":"s2","id":"d20a913a-9fdb-4f7a-962e-c0ad7d125bdc"},{"entity":"java.lang.Boolean","instance":"false","instanceName":"s1","id":"ec8302ad-d026-49e3-8f34-49888f3da395"},{"entity":"java.lang.String","instance":">{3BP!)8&M!/<4 A}txr","instanceName":"carl","id":"7084b306-85a6-4079-80c9-6b6ad854c4d8"},{"entity":"java.lang.Integer","instance":"-378250418","instanceName":"gene","id":"2018e1ee-aff5-41fa-b266-0ad0797355b1"},{"entity":"java.lang.Integer","instance":"6","instanceName":"larry","id":"b7938108-3dc9-4ed3-a090-1222c442ba41"}]]
var graphTitle = "EXAMPLE GRAPH"

var pageTitle = document.getElementById("page-title")
pageTitle.innerHTML = graphTitle

var graphVersion = 0;

var rootSubgraphName = "ROOT";
var subgraphNames = new Set(nodeVersions[0].map(n => n.data.subgraph));
var subgraphNamesArray = [...subgraphNames];
if (!subgraphNames.has(rootSubgraphName)) {
    subgraphNamesArray.unshift(rootSubgraphName);
}

for (var i = 0; i < subgraphNamesArray.length; i++) {
    var selected = i === 0;
    console.log(subgraphNamesArray[i]);
    document.getElementById("subgraph-view").appendChild(new Option(subgraphNamesArray[i], i, selected, selected))
}

function changeSubgraph(i) {
    var subgraphName = subgraphNamesArray[i];

    if (subgraphName === rootSubgraphName) {
        // refresh with all nodes and edges
        refreshGraph(nodeVersions[graphVersion], edgeVersions[graphVersion], workflows[graphVersion]);
        return;
    }

    // filter nodes
    var componentNodes = nodeVersions[graphVersion].filter(node => node.data.subgraph === subgraphName);
    var componentNodeIds = componentNodes.map(node => node.data.id);

    // filter edges
    var componentEdges = edgeVersions[graphVersion].filter(edge => componentNodeIds.includes(edge.data.source));

    // filter workflow
    var componentWorkflow = null;
    if (outcomes[graphVersion]) {
        componentWorkflow = workflows[graphVersion].filter(workflow => componentNodeIds.includes(workflow.id));
    }

    refreshGraph(componentNodes, componentEdges, componentWorkflow);
}

for (var i = 0; i < nodeVersions.length; i++) {
    var selected = i === 0;
    document.getElementById("graph-view").appendChild(new Option(i, i, selected, selected))
}

function refreshGraph(nodes, edges, workflow) {
    // changing the graph
    cy_r.elements().remove();

    var elements = {
        nodes: nodes,
        edges: edges
    }

    cy_r.add(elements);
    cy_r.layout({name: 'dagre', spacingFactor: 2}).run();

    // changing the table
    if (!outcomes[graphVersion]) {
        return;
    }

    var tableNode = document.getElementById("workflow-table");
    tableNode.innerHTML = "";
    //var outcomeNode = document.createTextNode("OUTCOME: " + outcomes[i]);
    //document.getElementById("workflow").insertBefore(outcomeNode, tableNode);
    for (var i = 0; i < workflow.length; i++) {
        var row = tableNode.insertRow(-1);
        var entityName = row.insertCell(0);
        var entityType = row.insertCell(1);
        var entityValue = row.insertCell(2);
        entityName.innerHTML = workflow[i].instanceName;
        entityType.innerHTML = workflow[i].entity;
        entityValue.innerHTML = workflow[i].instance;
    }
}

function changeGraph(i) {
    graphVersion = i;
    document.getElementById("subgraph-view").selectedIndex = 0;
    refreshGraph(nodeVersions[i], edgeVersions[i], workflows[i]);
}

var cy_r = cytoscape({
    container: document.getElementById('cy_r'),

    boxSelectionEnabled: false,
    autounselectify: true,

    style: cytoscape.stylesheet()
        .selector('node')
        .css({
            'content': 'data(name)',
            'width': 100,
            'height': 100,
            'font-size': 30,
            'background-color': '#4eff84'
        })
        .selector('edge')
        .css({
            'content': 'data(probability)',
            'curve-style': 'bezier',
            'font-size': 20,
            'target-arrow-shape': 'triangle',
            'width': 10,
            'line-color': '#ddd',
            'target-arrow-color': '#ddd',
            'control-point-step-size': 125
        })
        .selector('.highlighted')
        .css({
            'background-color': '#9e7aff',
            'line-color': '#9e7aff',
            'target-arrow-color': '#9e7aff',
            'transition-property': 'background-color, line-color, target-arrow-color',
            'transition-duration': '0.5s'
        }),

    elements: {
        nodes: nodeVersions[0],
        edges: edgeVersions[0]
    },

    layout: {
        name: 'dagre',
        spacingFactor: 2
    }
});

// DAGRE LAYOUT OPTIONS:
//var defaults = {
//  // dagre algo options, uses default value on undefined
//  nodeSep: undefined, // the separation between adjacent nodes in the same rank
//  edgeSep: undefined, // the separation between adjacent edges in the same rank
//  rankSep: undefined, // the separation between each rank in the layout
//  rankDir: undefined, // 'TB' for top to bottom flow, 'LR' for left to right,
//  ranker: undefined, // Type of algorithm to assign a rank to each node in the input graph. Possible values: 'network-simplex', 'tight-tree' or 'longest-path'
//  minLen: function( edge ){ return 1; }, // number of ranks to keep between the source and target of the edge
//  edgeWeight: function( edge ){ return 1; }, // higher weight edges are generally made shorter and straighter than lower weight edges
//
//  // general layout options
//  fit: true, // whether to fit to viewport
//  padding: 30, // fit padding
//  spacingFactor: undefined, // Applies a multiplicative factor (>0) to expand or compress the overall area that the nodes take up
//  nodeDimensionsIncludeLabels: false, // whether labels should be included in determining the space used by a node
//  animate: false, // whether to transition the node positions
//  animateFilter: function( node, i ){ return true; }, // whether to animate specific nodes when animation is on; non-animated nodes immediately go to their final positions
//  animationDuration: 500, // duration of animation in ms if enabled
//  animationEasing: undefined, // easing of animation if enabled
//  boundingBox: undefined, // constrain layout bounds; { x1, y1, x2, y2 } or { x1, y1, w, h }
//  transform: function( node, pos ){ return pos; }, // a function that applies a transform to the final node position
//  ready: function(){}, // on layoutready
//  stop: function(){} // on layoutstop
//};
